<!DOCTYPE html>
<html>
<head>
	<title>Dave's Portfolio</title>
	<%= stylesheet_link_tag    "application", :media => "all" %>
	<%= javascript_include_tag "application" %>
	<%= csrf_meta_tags %>

	<style type="text/css">
	body {
		font-family : arial , sans-serif ;
		color: #333;
		margin: 0 0 0 220px;
		position: relative;
		min-width: 440px;
	}
	h1, h3 {
		margin: 0;
	}
	body, div, nav, section, ul, textarea {
		box-sizing: border-box; -moz-box-sizing: border-box;
	}
	nav.main {
		position: absolute;
		width: 200px;
		left: -210px; top: 10px;
	}
	nav.main h1 {
		background: url(/assets/test-logo.png) 8px 1em no-repeat;
		padding-left: 60px;
		border-bottom: 1px solid #ccc;
	}
	nav.main > * {
		display: block;
		padding: 5px 10px;
	}
	nav.main a {
		color: #333;
		text-decoration: none;
		opacity: 0.9;
	}
	nav.main a:hover {
		opacity: 1;
	}
	nav.main a.selected {
		opacity: 0.5;
		cursor: default;
	}
 	div.main {
 		/*position: absolute;
 		left: 220px;
 		right: 0;
 		overflow-x: hidden;*/
 	}
 	section.main {
		position: relative;
		padding: 10px;
	}
 	#left_top_background {
		position: absolute;
		left: 0;
		right: 0;
		top: 0;
		bottom: 0;
		max-height: 1200px;
		background: url(/assets/desktop2.jpg) repeat-x;
		z-index: -1;
		opacity: 0.45;
	}
	#bottom_repeating_background {
		position: absolute;
		background: url(/assets/desktop2bottom.jpg);
		top: 1200px;
		bottom: 0px;
		width: 100%;
		z-index: -1;
		opacity: 0.43;
	}
	.vmw-waiting {
		opacity: 0.5;
	}
	.spinner {
		background: url(/assets/spinnerLarge.gif) no-repeat;
		width: 60px;
		height: 60px;
		display: none;
		position: absolute;
		z-index: 1;
		opacity: 0.5;
	}
</style>
</head>

<body>
	<nav class="main">
		<h1>Dave's Portfolio</h1>
		<a href="/samples/vmware">vmware</a>
		<a href="/samples/etrade">etrade samples</a>
		<a href="/tweets">ip twitter</a>
		<a href="/samples/uicontrols">modal dialog</a>
		<a href="/webrtc">camera input</a>
		<a href="/foo/charting_demo">svg charts</a>
		<a href="/samples/jquery_plugin">jquery plugin</a>
		<a href="/moviedb">backbone moviedb</a>
		<a href="/samples/ots_way">processing 3d canvas</a>
		<a href="/samples/algos">algorithms</a>
	</nav>

	<div id="left_top_background"></div>
	<div id="bottom_repeating_background"></div>
	<div class="spinner"></div>
	<div class="main">
		<section style="padding:10px"></section>
	</div>
</body>

<script>

var g = window

$.fn.vload = function ( url , fnDone ){
	// returning jqXHR , so no regular chaining
	return this.vjax( url , {
		dataType : 'html'
	}).done ( function ( responseHtml ){
		this .html( responseHtml )
	})
}

$.fn.vjax = function ( url , options ){
	var o = this.o = {}
  	$.extend( o , {
		url : url ,
		type : 'get' , // defaulting
		dataType : 'json' , // expecting from server
		context : this , // jQuery.ajax() option for jqXHR.done/always/...
		beforeSend : function ( jqXHR ){
			// expecting atomic DOM access within this handler
			// last request per DOM element wins
			o.jqXHR && o.jqXHR.abort() // aborting pending if any
			o.jqXHR = jqXHR
			o.context.addClass( 'vmw-waiting' )
			var target = o.context[ 0].getBoundingClientRect()
			var doc = document.documentElement
			var height = Math.min( target.bottom , doc.clientHeight ) -
				Math.max( target.top , 0 )
			var width = Math.min( target.right , doc.clientWidth ) -
				Math.max( target.left , 0 )
			var offset = o.context.offset()
			var top = Math.max( offset.top , document.body.scrollTop )
			var left = Math.max( offset.left , document.body.scrollLeft )
			$( '> .spinner' , document.body ).css ({
				top : top + height/2 - 30 ,
				left : left + width/2 - 30 -
					parseInt( $( document.body ).css( 'margin-left') )

			})
			.show()
		} ,
		complete : function (){
			o.jqXHR = null // resetting handle
			o.context.removeClass( 'vmw-waiting' )
			$( '> .spinner' , document.body ).hide()
		}
	})

	// defaulting for post-put data
	options && options.data && /(post|put)/i .test( options .type ) &&
		$ .extend ( o , {
			contentType : 'application/json' , // sending to server
			processData : false
		})

	// returning jqXHR object , so no regular chaining
	return $.ajax( $.extend ( o , options ) )
} // vjax

String .prototype .f = function (){
	var a = arguments
	return this .replace ( /{(\d+)}/g , function ( m , n ){ 
		return a [ n ]
	})
} // String.prototype.f

g.$my_nav = $( 'nav.main').on(
	'click' , '> a' , function ( e ){
		var o = {}
		e.stopPropagation()
		e.preventDefault();
		if ( ( o .$a = $( this ) ).hasClass( 'selected' ) ){
			// already selected , doing nothing
		} else {
			o .$a .siblings( 'a' ).removeClass( 'selected').end()
			$( '> section' , 'div.main' ) .vload ( o .$a .attr( 'href' ) )
				.done ( function (){
					o .$a .addClass( 'selected')
				})
		}
	} // click
)

$( 'a[href$="/tweets"]' , g.$my_nav ).click() // default

</script>

</html>
